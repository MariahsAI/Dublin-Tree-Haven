<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Your Stay | Dublin Tree Haven</title>
    <link rel="icon" type="image/jpeg" href="dublin-tree-haven-logo.jpg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Raleway:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --deep-forest: #1a2e1a;
            --moss: #2d4a2d;
            --sage: #5a7a5a;
            --gold: #c9a962;
            --gold-light: #e4d4a5;
            --cream: #f5f2eb;
            --cream-dark: #ebe7dc;
            --bark: #4a3728;
            --white: #ffffff;
            --error: #c94444;
            --success: #44c962;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Raleway', sans-serif; background: var(--cream); color: var(--deep-forest); min-height: 100vh; }

        /* Header */
        .booking-header {
            background: var(--deep-forest);
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-logo { display: flex; align-items: center; gap: 12px; text-decoration: none; }
        .header-logo img { height: 45px; width: 45px; object-fit: contain; }
        .header-logo span { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; color: var(--gold); letter-spacing: 2px; }
        .header-secure { display: flex; align-items: center; gap: 8px; color: var(--cream); font-size: 0.8rem; }
        .header-secure svg { width: 16px; height: 16px; stroke: var(--gold); }

        /* Progress */
        .progress-bar { background: var(--white); padding: 20px 40px; border-bottom: 1px solid var(--cream-dark); }
        .progress-steps { display: flex; justify-content: center; align-items: center; gap: 15px; max-width: 500px; margin: 0 auto; }
        .step { display: flex; align-items: center; gap: 8px; }
        .step-number { width: 28px; height: 28px; border-radius: 50%; background: var(--cream); color: var(--sage); display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; }
        .step.active .step-number { background: var(--gold); color: var(--deep-forest); }
        .step.completed .step-number { background: var(--success); color: var(--white); }
        .step-label { font-size: 0.8rem; color: var(--sage); }
        .step.active .step-label { color: var(--deep-forest); font-weight: 600; }
        .step-connector { width: 50px; height: 2px; background: var(--cream-dark); }

        /* Main */
        .booking-main { max-width: 1100px; margin: 0 auto; padding: 30px 40px; display: grid; grid-template-columns: 1fr 380px; gap: 30px; }

        /* Forms */
        .booking-forms { display: flex; flex-direction: column; gap: 25px; }
        .form-section { background: var(--white); border-radius: 12px; padding: 25px; box-shadow: 0 2px 15px rgba(26,46,26,0.06); }
        .section-title { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; color: var(--deep-forest); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .section-title svg { width: 22px; height: 22px; stroke: var(--gold); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-group:last-child { margin-bottom: 0; }
        .form-group label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--bark); margin-bottom: 6px; }
        .form-group label .required { color: var(--error); }
        .form-group input, .form-group select { width: 100%; padding: 12px 14px; border: 2px solid var(--cream-dark); border-radius: 8px; font-family: 'Raleway', sans-serif; font-size: 0.95rem; color: var(--deep-forest); background: var(--white); transition: all 0.3s ease; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--gold); box-shadow: 0 0 0 3px rgba(201,169,98,0.1); }
        .form-group input::placeholder { color: var(--sage); }
        .form-group textarea { width: 100%; padding: 12px 14px; border: 2px solid var(--cream-dark); border-radius: 8px; font-family: 'Raleway', sans-serif; font-size: 0.95rem; resize: none; height: 80px; }
        .form-group textarea:focus { outline: none; border-color: var(--gold); }

        /* Trip Details */
        .trip-details { background: var(--cream); border-radius: 8px; padding: 18px; margin-bottom: 20px; }
        .trip-dates { display: flex; align-items: center; gap: 12px; }
        .date-box { flex: 1; text-align: center; padding: 12px; background: var(--white); border-radius: 8px; }
        .date-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: var(--sage); margin-bottom: 8px; }
        .date-value { font-family: 'Cormorant Garamond', serif; font-size: 1.2rem; color: var(--deep-forest); font-weight: 600; }
        .date-input { position: absolute; opacity: 0; width: 100%; height: 100%; top: 0; left: 0; cursor: pointer; z-index: 5; }
        .date-box { flex: 1; text-align: center; padding: 20px 15px; background: var(--white); border-radius: 10px; position: relative; cursor: pointer; transition: all 0.2s; border: 2px solid var(--cream-dark); }
        .date-box:hover { border-color: var(--gold); box-shadow: 0 4px 12px rgba(201,169,98,0.15); }
        .date-box:focus-within { border-color: var(--gold); box-shadow: 0 4px 12px rgba(201,169,98,0.2); }
        .trip-details { background: var(--cream); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .trip-dates { display: flex; align-items: center; gap: 15px; }
        .date-arrow { color: var(--gold); padding: 0 5px; }
        .date-arrow svg { width: 24px; height: 24px; stroke: var(--gold); }
        .trip-guests { margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--cream-dark); display: flex; justify-content: space-between; align-items: center; font-size: 0.95rem; position: relative; }
        .guest-picker { position: absolute; top: 100%; left: 0; right: 0; background: var(--white); border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 15px; margin-top: 10px; z-index: 10; }
        .guest-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--cream-dark); }
        .guest-row:last-of-type { border-bottom: none; }
        .guest-counter { display: flex; align-items: center; gap: 15px; }
        .guest-counter button { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--sage); background: var(--white); color: var(--deep-forest); font-size: 1.3rem; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .guest-counter button:hover { border-color: var(--gold); background: var(--gold); }
        .guest-counter span { font-weight: 600; min-width: 24px; text-align: center; font-size: 1.1rem; }
        .guest-done { width: 100%; margin-top: 12px; padding: 12px; background: var(--gold); border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.95rem; }
        .availability-notice { display: flex; align-items: center; gap: 10px; padding: 12px 15px; background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; margin-bottom: 20px; font-size: 0.85rem; color: #92400e; }
        .availability-notice.error { background: #fee2e2; border-color: #ef4444; color: #991b1b; }
        .availability-notice.success { background: #d1fae5; border-color: #10b981; color: #065f46; }
        .availability-notice svg { width: 20px; height: 20px; flex-shrink: 0; }
        .blocked-date { background: #fee2e2 !important; color: #991b1b !important; cursor: not-allowed !important; text-decoration: line-through; }
        .guests-info { display: flex; align-items: center; gap: 8px; }
        .guests-info svg { width: 18px; height: 18px; stroke: var(--sage); }
        .edit-link { color: var(--gold); text-decoration: none; font-size: 0.8rem; font-weight: 600; cursor: pointer; }

        /* Payment */
        .payment-methods { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .payment-option { display: flex; align-items: center; gap: 12px; padding: 15px; border: 2px solid var(--cream-dark); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .payment-option:hover { border-color: var(--sage); }
        .payment-option.selected { border-color: var(--gold); background: rgba(201,169,98,0.05); }
        .payment-radio { width: 18px; height: 18px; border: 2px solid var(--sage); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .payment-option.selected .payment-radio { border-color: var(--gold); }
        .payment-radio::after { content: ''; width: 8px; height: 8px; border-radius: 50%; background: var(--gold); opacity: 0; }
        .payment-option.selected .payment-radio::after { opacity: 1; }
        .payment-info { flex: 1; }
        .payment-title { font-weight: 600; color: var(--deep-forest); font-size: 0.95rem; }
        .payment-desc { font-size: 0.8rem; color: var(--sage); }
        .card-icons { display: flex; gap: 5px; }
        .card-icon { width: 36px; height: 24px; background: var(--cream); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; font-weight: bold; color: var(--bark); }

        /* Summary */
        .booking-summary { position: sticky; top: 100px; }
        .summary-card { background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: 0 2px 15px rgba(26,46,26,0.06); }
        .summary-property { display: flex; gap: 12px; padding: 18px; border-bottom: 1px solid var(--cream-dark); }
        .property-image { width: 100px; height: 75px; border-radius: 8px; overflow: hidden; flex-shrink: 0; }
        .property-image img { width: 100%; height: 100%; object-fit: cover; }
        .property-info { flex: 1; }
        .property-name { font-family: 'Cormorant Garamond', serif; font-size: 1.1rem; color: var(--deep-forest); margin-bottom: 4px; }
        .property-location { font-size: 0.8rem; color: var(--sage); display: flex; align-items: center; gap: 4px; margin-bottom: 6px; }
        .property-location svg { width: 12px; height: 12px; }
        .property-rating { display: flex; align-items: center; gap: 4px; font-size: 0.8rem; }
        .star { color: var(--gold); }
        .summary-dates { padding: 15px 18px; background: var(--cream); }
        .summary-date-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85rem; }
        .summary-date-row:last-child { margin-bottom: 0; }
        .summary-date-label { color: var(--sage); }
        .summary-date-value { font-weight: 600; }
        .summary-pricing { padding: 18px; }
        .price-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; }
        .price-row.discount { color: var(--success); }
        .price-row.total { margin-top: 12px; padding-top: 12px; border-top: 2px solid var(--cream-dark); font-size: 1.05rem; font-weight: 600; }
        .btn-book { width: 100%; padding: 16px; background: var(--gold); color: var(--deep-forest); border: none; border-radius: 8px; font-family: 'Raleway', sans-serif; font-size: 1rem; font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: all 0.3s ease; }
        .btn-book:hover { background: var(--deep-forest); color: var(--gold); transform: translateY(-2px); box-shadow: 0 8px 25px rgba(26,46,26,0.2); }
        .secure-note { text-align: center; margin-top: 12px; font-size: 0.8rem; color: var(--sage); }
        .payment-note { text-align: center; margin-top: 15px; font-size: 0.7rem; color: var(--sage); padding-top: 15px; border-top: 1px solid var(--cream-dark); }

        /* Policy Sections */
        .policies { padding: 0; border-top: none; }
        .policy-section { border-bottom: 1px solid var(--cream-dark); }
        .policy-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 18px; cursor: pointer; transition: background 0.2s; }
        .policy-header:hover { background: var(--cream); }
        .policy-header h4 { font-size: 0.95rem; font-weight: 600; color: var(--deep-forest); margin: 0; }
        .policy-header .chevron { width: 18px; height: 18px; stroke: var(--sage); transition: transform 0.3s; }
        .policy-header.open .chevron { transform: rotate(180deg); }
        .policy-tag { margin: 0 18px 10px; padding: 6px 12px; background: var(--cream); border-radius: 4px; font-size: 0.8rem; font-weight: 600; color: var(--bark); display: inline-block; }
        .policy-preview { padding: 0 18px 10px; font-size: 0.85rem; color: var(--sage); }
        .policy-content { padding: 0 18px 18px; font-size: 0.85rem; color: var(--bark); line-height: 1.7; display: none; }
        .policy-content.expanded { display: block; }
        .policy-content p { margin-bottom: 12px; }
        .policy-content p:last-child { margin-bottom: 0; }
        .policy-content ul { margin: 0; padding-left: 20px; }
        .policy-content li { margin-bottom: 8px; }
        .protection-note { display: flex; align-items: center; gap: 12px; padding: 18px; background: var(--cream); margin: 0; font-size: 0.85rem; color: var(--bark); }
        .protection-note svg { width: 24px; height: 24px; stroke: #3b82f6; flex-shrink: 0; }
        .legal-agreement { padding: 18px; font-size: 0.8rem; color: var(--sage); line-height: 1.6; }
        .legal-agreement a { color: #3b82f6; text-decoration: none; }
        .legal-agreement a:hover { text-decoration: underline; }
        .btn-book { display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-book svg { width: 18px; height: 18px; }
        .booking-cta { padding: 18px; background: var(--white); border-top: 1px solid var(--cream-dark); }

        /* Policies */
        .policies { padding: 18px; border-top: 1px solid var(--cream-dark); }
        .policy-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; font-size: 0.8rem; color: var(--bark); }
        .policy-item:last-child { margin-bottom: 0; }
        .policy-item svg { width: 16px; height: 16px; stroke: var(--success); flex-shrink: 0; margin-top: 2px; }

        /* Sidebar Widgets */
        .sidebar-widgets { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .urgency-widget { display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--white); border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); }
        .urgency-icon { width: 40px; height: 40px; background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .urgency-icon svg { width: 20px; height: 20px; stroke: #0284c7; }
        .urgency-text h5 { font-size: 0.9rem; font-weight: 600; color: var(--deep-forest); margin: 0 0 2px; }
        .urgency-text p { font-size: 0.8rem; color: var(--sage); margin: 0; }
        .manage-widget { display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--deep-forest); border-radius: 10px; }
        .manage-icon { width: 36px; height: 36px; background: rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .manage-icon svg { width: 18px; height: 18px; fill: var(--gold); stroke: none; }
        .manage-text { flex: 1; }
        .manage-text h5 { font-size: 0.85rem; font-weight: 500; color: var(--white); margin: 0 0 5px; }
        .manage-links { display: flex; gap: 15px; }
        .manage-links a { font-size: 0.8rem; color: #93c5fd; text-decoration: none; }
        .manage-links a:hover { text-decoration: underline; }

        /* Responsive */
        @media (max-width: 900px) {
            .booking-main { grid-template-columns: 1fr; padding: 15px; gap: 20px; }
            .booking-summary { position: relative; top: 0; order: -1; }
            .sidebar-widgets { display: none; }
            .form-row { grid-template-columns: 1fr; }
            .summary-property { flex-direction: column; text-align: center; }
            .property-image { width: 100%; height: 150px; }
            .property-info { text-align: center; }
            .property-location { justify-content: center; }
            .property-rating { justify-content: center; }
        }
        @media (max-width: 600px) {
            .booking-header { padding: 12px 15px; }
            .header-logo span { display: none; }
            .progress-bar { padding: 15px; }
            .progress-steps { gap: 8px; }
            .step-label { display: none; }
            .step-connector { width: 25px; }
            .form-section { padding: 20px 15px; }
            .section-title { font-size: 1.25rem; }
            .trip-dates { flex-direction: column; gap: 10px; }
            .date-arrow { transform: rotate(90deg); padding: 5px 0; }
            .date-box { padding: 15px; }
            .summary-pricing { padding: 15px; }
            .price-row { font-size: 0.85rem; }
            .policies { font-size: 0.85rem; }
            .policy-header { padding: 12px 15px; }
            .policy-content { padding: 0 15px 15px; }
            .btn-book { padding: 14px; font-size: 0.95rem; }
        }
        
        /* Mobile-first price highlight */
        @media (max-width: 900px) {
            .summary-card {
                border: 2px solid var(--gold);
            }
            .summary-pricing {
                background: var(--cream);
                border-radius: 8px;
                margin: 10px;
            }
            .price-row.total {
                font-size: 1.2rem;
                color: var(--deep-forest);
            }
            .booking-cta {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--white);
                box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
                padding: 15px 20px;
                z-index: 100;
                border-top: 1px solid var(--cream-dark);
            }
            .booking-main {
                padding-bottom: 100px;
            }
        }

        /* Mobile Price Banner */
        .mobile-price-banner {
            display: none;
            background: linear-gradient(135deg, var(--deep-forest) 0%, var(--moss) 100%);
            padding: 15px 20px;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 70px;
            z-index: 90;
        }
        .mobile-price-info {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }
        .mobile-price-label {
            color: var(--cream);
            font-size: 0.85rem;
            opacity: 0.8;
        }
        .mobile-price-amount {
            color: var(--gold);
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Cormorant Garamond', serif;
        }
        .mobile-price-nights {
            color: var(--cream);
            font-size: 0.85rem;
            opacity: 0.8;
        }
        @media (max-width: 900px) {
            .mobile-price-banner {
                display: flex;
            }
            .booking-summary {
                display: none;
            }
            .booking-forms {
                order: 1;
            }
        }

        /* Mobile Policies Section */
        .mobile-policies {
            display: none;
        }
        .mobile-policy-item {
            border-bottom: 1px solid var(--cream-dark);
            padding: 0;
        }
        .mobile-policy-item:last-of-type {
            border-bottom: none;
        }
        .mobile-policy-header {
            display: flex;
            align-items: center;
            padding: 15px 0;
            cursor: pointer;
            gap: 10px;
        }
        .mobile-policy-header span:first-child {
            flex: 1;
            font-weight: 600;
            color: var(--deep-forest);
        }
        .mobile-policy-header .chevron {
            width: 18px;
            height: 18px;
            stroke: var(--sage);
            transition: transform 0.3s;
        }
        .mobile-policy-header.open .chevron {
            transform: rotate(180deg);
        }
        .policy-badge {
            font-size: 0.7rem;
            padding: 4px 8px;
            background: var(--cream);
            border-radius: 4px;
            color: var(--bark);
            font-weight: 600;
        }
        .mobile-policy-content {
            display: none;
            padding: 0 0 15px 0;
            font-size: 0.85rem;
            color: var(--bark);
            line-height: 1.8;
        }
        .mobile-policy-content.open {
            display: block;
        }
        .mobile-policy-content p {
            margin: 0;
        }
        .mobile-legal {
            padding: 15px 0 0;
            font-size: 0.8rem;
            color: var(--sage);
            border-top: 1px solid var(--cream-dark);
            margin-top: 10px;
        }
        .mobile-legal a {
            color: #3b82f6;
            text-decoration: none;
        }
        @media (max-width: 900px) {
            .mobile-policies {
                display: block;
            }
        }

        /* Mobile Sticky Footer */
        .mobile-sticky-footer {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            padding: 12px 20px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 100;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid var(--cream-dark);
        }
        .mobile-footer-price {
            display: flex;
            flex-direction: column;
        }
        .mobile-footer-total {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--deep-forest);
            font-family: 'Cormorant Garamond', serif;
        }
        .mobile-footer-label {
            font-size: 0.75rem;
            color: var(--sage);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .mobile-footer-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 30px;
            background: var(--gold);
            color: var(--deep-forest);
            border: none;
            border-radius: 8px;
            font-family: 'Raleway', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        .mobile-footer-btn svg {
            width: 18px;
            height: 18px;
        }
        @media (max-width: 900px) {
            .mobile-sticky-footer {
                display: flex;
            }
            .booking-main {
                padding-bottom: 90px;
            }
            .booking-cta {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="booking-header">
        <a href="dublin-fresh.html" class="header-logo">
            <img src="dublin-tree-haven-logo.jpg" alt="Dublin Tree Haven">
            <span>Dublin Tree Haven</span>
        </a>
        <div class="header-secure">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            Secure Checkout
        </div>
    </header>

    <!-- Progress -->
    <div class="progress-bar">
        <div class="progress-steps">
            <div class="step completed">
                <div class="step-number">✓</div>
                <span class="step-label">Select</span>
            </div>
            <div class="step-connector completed"></div>
            <div class="step active">
                <div class="step-number">2</div>
                <span class="step-label">Details</span>
            </div>
            <div class="step-connector"></div>
            <div class="step">
                <div class="step-number">3</div>
                <span class="step-label">Confirm</span>
            </div>
        </div>
    </div>

    <!-- Mobile Price Banner (shows only on mobile) -->
    <div class="mobile-price-banner" id="mobilePriceBanner">
        <div class="mobile-price-info">
            <span class="mobile-price-label">Total</span>
            <span class="mobile-price-amount" id="mobile-total">$3,105</span>
        </div>
        <div class="mobile-price-nights" id="mobile-nights">7 nights</div>
    </div>

    <!-- Main Content -->
    <main class="booking-main">
        <!-- Left - Forms -->
        <div class="booking-forms">
            <!-- Trip Details -->
            <section class="form-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                    Your Trip
                </h2>
                <div class="trip-details">
                    <div class="trip-dates">
                        <div class="date-box" onclick="document.getElementById('checkin-date').showPicker()">
                            <div class="date-label">CHECK-IN</div>
                            <div class="date-value" id="checkin-display">Fri, Dec 13</div>
                            <input type="date" id="checkin-date" class="date-input" value="2025-12-13">
                        </div>
                        <div class="date-arrow">
                            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                        </div>
                        <div class="date-box" onclick="document.getElementById('checkout-date').showPicker()">
                            <div class="date-label">CHECK-OUT</div>
                            <div class="date-value" id="checkout-display">Sat, Dec 20</div>
                            <input type="date" id="checkout-date" class="date-input" value="2025-12-20">
                        </div>
                    </div>
                    <div class="trip-guests">
                        <div class="guests-info">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                            <span id="guests-nights">2 Guests • 7 Nights</span>
                        </div>
                        <a class="edit-link" onclick="openGuestPicker()">Edit</a>
                    </div>
                    <!-- Guest Picker Popup -->
                    <div id="guest-picker" class="guest-picker" style="display:none;">
                        <div class="guest-row">
                            <span>Adults</span>
                            <div class="guest-counter">
                                <button type="button" onclick="adjustGuests('adults', -1)">−</button>
                                <span id="adult-count">2</span>
                                <button type="button" onclick="adjustGuests('adults', 1)">+</button>
                            </div>
                        </div>
                        <div class="guest-row">
                            <span>Children</span>
                            <div class="guest-counter">
                                <button type="button" onclick="adjustGuests('children', -1)">−</button>
                                <span id="child-count">0</span>
                                <button type="button" onclick="adjustGuests('children', 1)">+</button>
                            </div>
                        </div>
                        <button type="button" class="guest-done" onclick="closeGuestPicker()">Done</button>
                    </div>
                </div>
                
                <!-- Availability Notice -->
                <div class="availability-notice" id="availability-notice" style="display:none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    <span id="availability-message">Checking availability...</span>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Check-in Time</label>
                        <select>
                            <option>3:00 PM - 4:00 PM</option>
                            <option>4:00 PM - 5:00 PM</option>
                            <option>5:00 PM - 6:00 PM</option>
                            <option>6:00 PM - 7:00 PM</option>
                            <option selected>Flexible</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Purpose of Trip</label>
                        <select>
                            <option selected>Leisure / Vacation</option>
                            <option>Romantic Getaway</option>
                            <option>Family Retreat</option>
                            <option>Special Occasion</option>
                            <option>Other</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Guest Details -->
            <section class="form-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    Guest Details
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name <span class="required">*</span></label>
                        <input type="text" placeholder="Enter first name" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name <span class="required">*</span></label>
                        <input type="text" placeholder="Enter last name" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email Address <span class="required">*</span></label>
                        <input type="email" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label>Phone Number <span class="required">*</span></label>
                        <input type="tel" placeholder="+1 (555) 123-4567" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Country of Residence</label>
                    <select>
                        <option>United States</option>
                        <option>Canada</option>
                        <option>United Kingdom</option>
                        <option>Ireland</option>
                        <option>Germany</option>
                        <option>France</option>
                        <option>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Special Requests (Optional)</label>
                    <textarea placeholder="Any special requirements, celebrations, or requests..."></textarea>
                </div>
            </section>

            <!-- Payment -->
            <section class="form-section">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                    Payment Method
                </h2>
                <div class="payment-methods">
                    <div class="payment-option selected" onclick="selectPayment(this)">
                        <div class="payment-radio"></div>
                        <div class="payment-info">
                            <div class="payment-title">Credit or Debit Card</div>
                            <div class="payment-desc">Pay securely with your card</div>
                        </div>
                        <div class="card-icons">
                            <div class="card-icon">VISA</div>
                            <div class="card-icon">MC</div>
                            <div class="card-icon">AMEX</div>
                        </div>
                    </div>
                    <div class="payment-option" onclick="selectPayment(this)">
                        <div class="payment-radio"></div>
                        <div class="payment-info">
                            <div class="payment-title">PayPal</div>
                            <div class="payment-desc">Fast and secure payment</div>
                        </div>
                    </div>
                    <div class="payment-option" onclick="selectPayment(this)">
                        <div class="payment-radio"></div>
                        <div class="payment-info">
                            <div class="payment-title">Bank Transfer</div>
                            <div class="payment-desc">Pay directly from your bank</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Cardholder Name <span class="required">*</span></label>
                    <input type="text" placeholder="Name on card">
                </div>
                <div class="form-group">
                    <label>Card Number <span class="required">*</span></label>
                    <input type="text" placeholder="1234 5678 9012 3456" maxlength="19">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Expiry Date <span class="required">*</span></label>
                        <input type="text" placeholder="MM / YY" maxlength="7">
                    </div>
                    <div class="form-group">
                        <label>CVV <span class="required">*</span></label>
                        <input type="text" placeholder="123" maxlength="4">
                    </div>
                </div>
            </section>

            <!-- Mobile Policies (shows only on mobile) -->
            <section class="form-section mobile-policies">
                <h2 class="section-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                    Policies & Rules
                </h2>
                
                <div class="mobile-policy-item">
                    <div class="mobile-policy-header" onclick="toggleMobilePolicy(this)">
                        <span>Cancellation policy</span>
                        <span class="policy-badge">Partially refundable</span>
                        <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </div>
                    <div class="mobile-policy-content">
                        <p>• 50% refund if cancelled before <span id="mobile-cancel-date">Dec 6, 2025</span></p>
                        <p>• No refund after that date</p>
                        <p>• Service fee only refundable when fully refundable</p>
                    </div>
                </div>

                <div class="mobile-policy-item">
                    <div class="mobile-policy-header" onclick="toggleMobilePolicy(this)">
                        <span>House rules</span>
                        <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </div>
                    <div class="mobile-policy-content">
                        <p>• Minimum age: 21</p>
                        <p>• No smoking</p>
                        <p>• No pets</p>
                        <p>• No parties</p>
                        <p>• Quiet hours: 10 PM - 8 AM</p>
                    </div>
                </div>

                <div class="mobile-policy-item">
                    <div class="mobile-policy-header" onclick="toggleMobilePolicy(this)">
                        <span>Check-out instructions</span>
                        <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                    </div>
                    <div class="mobile-policy-content">
                        <p>• Check-out by 11:00 AM</p>
                        <p>• Leave keys on kitchen counter</p>
                        <p>• Lock all doors and windows</p>
                    </div>
                </div>

                <div class="mobile-legal">
                    <p>By booking, you agree to the <a href="#">Privacy Policy</a> and <a href="#">Terms of Service</a>.</p>
                </div>
            </section>
        </div>

        <!-- Right - Summary -->
        <aside class="booking-summary">
            <!-- Sidebar Widgets -->
            <div class="sidebar-widgets">
                <div class="urgency-widget">
                    <div class="urgency-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    </div>
                    <div class="urgency-text">
                        <h5>Act fast!</h5>
                        <p>Price and availability may change</p>
                    </div>
                </div>
                <div class="manage-widget">
                    <div class="manage-icon">
                        <svg viewBox="0 0 24 24"><circle cx="5" cy="7" r="2"/><circle cx="12" cy="7" r="2"/><circle cx="19" cy="7" r="2"/><circle cx="5" cy="17" r="2"/><circle cx="12" cy="17" r="2"/><circle cx="19" cy="17" r="2"/></svg>
                    </div>
                    <div class="manage-text">
                        <h5>Manage your booking</h5>
                        <div class="manage-links">
                            <a href="#">Sign in</a>
                            <a href="#">Create account</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <div class="summary-property">
                    <div class="property-image">
                        <img src="https://images.unsplash.com/photo-1510798831971-661eb04b3739?w=400" alt="Dublin Tree Haven">
                    </div>
                    <div class="property-info">
                        <h3 class="property-name">Dublin Tree Haven</h3>
                        <div class="property-location">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                            Wicklow Mountains, Ireland
                        </div>
                        <div class="property-rating">
                            <span class="star">★★★★★</span>
                            <span>4.9 (127 reviews)</span>
                        </div>
                    </div>
                </div>

                <div class="summary-dates">
                    <div class="summary-date-row">
                        <span class="summary-date-label">Check-in</span>
                        <span class="summary-date-value" id="summary-checkin">Fri, Dec 13, 2025</span>
                    </div>
                    <div class="summary-date-row">
                        <span class="summary-date-label">Check-out</span>
                        <span class="summary-date-value" id="summary-checkout">Sat, Dec 20, 2025</span>
                    </div>
                    <div class="summary-date-row">
                        <span class="summary-date-label">Guests</span>
                        <span class="summary-date-value" id="summary-guests">2 Adults</span>
                    </div>
                </div>

                <div class="summary-pricing">
                    <div class="price-row">
                        <span id="price-nights">$450 × 7 nights</span>
                        <span id="price-subtotal">$3,150</span>
                    </div>
                    <div class="price-row">
                        <span>Cleaning fee</span>
                        <span>$150</span>
                    </div>
                    <div class="price-row">
                        <span>Service fee</span>
                        <span>$120</span>
                    </div>
                    <div class="price-row discount" id="discount-row">
                        <span id="discount-label">Weekly discount (10%)</span>
                        <span id="discount-amount">-$315</span>
                    </div>
                    <div class="price-row total">
                        <span>Total (USD)</span>
                        <span id="price-total">$3,105</span>
                    </div>
                </div>

                <div class="policies">
                    <!-- Cancellation Policy -->
                    <div class="policy-section">
                        <div class="policy-header" onclick="togglePolicy(this)">
                            <h4>Cancellation policy</h4>
                            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="policy-tag">Partially refundable</div>
                        <div class="policy-content expanded">
                            <p>Cancellations or changes made before 11:59pm (property local time) on <span id="cancel-date-50">Dec 6, 2025</span> or no-shows are subject to a property fee equal to 50% of the total amount paid for the reservation.</p>
                            <p>Cancellations or changes made after 11:59pm (property local time) on <span id="cancel-date-100">Dec 6, 2025</span> or no-shows are subject to a property fee equal to 100% of the total amount paid for the reservation.</p>
                            <p>Service Fee is only refundable when the booking is fully refundable.</p>
                        </div>
                    </div>

                    <!-- Check-out Instructions -->
                    <div class="policy-section">
                        <div class="policy-header" onclick="togglePolicy(this)">
                            <h4>Check-out instructions</h4>
                            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="policy-content">
                            <ul>
                                <li>Check-out by 11:00 AM</li>
                                <li>Leave keys on the kitchen counter</li>
                                <li>Ensure all windows and doors are locked</li>
                                <li>Take all personal belongings</li>
                                <li>Place used towels in the bathroom</li>
                            </ul>
                        </div>
                    </div>

                    <!-- House Rules -->
                    <div class="policy-section">
                        <div class="policy-header" onclick="togglePolicy(this)">
                            <h4>House rules</h4>
                            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="policy-preview">Minimum age to rent: 21</div>
                        <div class="policy-content">
                            <ul>
                                <li>Minimum age to rent: 21</li>
                                <li>No smoking</li>
                                <li>No pets allowed</li>
                                <li>No parties or events</li>
                                <li>Quiet hours: 10:00 PM - 8:00 AM</li>
                                <li>Maximum occupancy: 6 guests</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Cancellation Protection -->
                    <div class="protection-note">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><polyline points="9 12 12 15 16 10"/></svg>
                        <span>You can add Cancellation Protection after booking.</span>
                    </div>

                    <!-- Legal Agreement -->
                    <div class="legal-agreement">
                        <p>By clicking on the button below, I confirm I have read and accept the <a href="#">Privacy Statement</a>, house rules, check-out instructions, rental agreement, and <a href="#">Terms of Service</a>.</p>
                    </div>
                </div>

                <div class="booking-cta">
                    <button class="btn-book" onclick="confirmBooking()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        <span id="btn-total">Book now</span>
                    </button>
                    <div class="secure-note">
                        Our secure encryption protects your personal details at every step.
                    </div>
                    <div class="payment-note">
                        This payment will be processed in the US. This does not apply when the travel provider (airline/hotel/rail, etc.) processes your payment outside the U.S.
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Mobile Sticky Footer -->
    <div class="mobile-sticky-footer" id="mobileFooter">
        <div class="mobile-footer-price">
            <span class="mobile-footer-total" id="mobile-footer-total">$3,105</span>
            <span class="mobile-footer-label">total</span>
        </div>
        <button class="mobile-footer-btn" onclick="confirmBooking()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            Book Now
        </button>
    </div>

    <script>
        // =====================================================
        // BLOCKED DATES - Sync these from your Airbnb calendar
        // To get your Airbnb iCal URL:
        // 1. Go to Airbnb > Your Listings > Calendar
        // 2. Click "Availability" > "Sync calendars"
        // 3. Copy the "Export Calendar" link
        // 4. Use a server/service to parse the iCal and update this array
        // =====================================================
        const BLOCKED_DATES = [
            // Format: 'YYYY-MM-DD'
            // Example blocked dates (replace with your actual bookings)
            '2025-12-24', '2025-12-25', '2025-12-26', '2025-12-27', '2025-12-28',
            '2025-12-31', '2026-01-01', '2026-01-02',
            '2026-01-15', '2026-01-16', '2026-01-17', '2026-01-18', '2026-01-19',
        ];

        // Booking state
        const NIGHTLY_RATE = 450;
        const CLEANING_FEE = 150;
        const SERVICE_FEE = 120;
        
        let state = {
            checkin: new Date('2025-12-13'),
            checkout: new Date('2025-12-20'),
            adults: 2,
            children: 0
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set up date input listeners
            document.getElementById('checkin-date').addEventListener('change', function(e) {
                state.checkin = new Date(e.target.value + 'T00:00:00');
                // Ensure checkout is after checkin
                if (state.checkout <= state.checkin) {
                    state.checkout = new Date(state.checkin);
                    state.checkout.setDate(state.checkout.getDate() + 1);
                    document.getElementById('checkout-date').value = formatDateForInput(state.checkout);
                }
                updateAllDisplays();
                checkAvailability();
            });
            
            document.getElementById('checkout-date').addEventListener('change', function(e) {
                const newCheckout = new Date(e.target.value + 'T00:00:00');
                if (newCheckout > state.checkin) {
                    state.checkout = newCheckout;
                    updateAllDisplays();
                    checkAvailability();
                } else {
                    alert('Check-out must be after check-in date');
                    e.target.value = formatDateForInput(state.checkout);
                }
            });

            // Set minimum dates
            const today = new Date();
            document.getElementById('checkin-date').min = formatDateForInput(today);
            
            updateAllDisplays();
            checkAvailability();
        });

        function formatDateForInput(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDateShort(date) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}`;
        }

        function formatDateLong(date) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
        }

        function formatDatePolicy(date) {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
        }

        function getNights() {
            const diffTime = Math.abs(state.checkout - state.checkin);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Check if a date range overlaps with blocked dates
        function getBlockedDatesInRange(startDate, endDate) {
            const blocked = [];
            const current = new Date(startDate);
            
            while (current < endDate) {
                const dateStr = formatDateForInput(current);
                if (BLOCKED_DATES.includes(dateStr)) {
                    blocked.push(dateStr);
                }
                current.setDate(current.getDate() + 1);
            }
            
            return blocked;
        }

        function checkAvailability() {
            const notice = document.getElementById('availability-notice');
            const message = document.getElementById('availability-message');
            const bookBtn = document.querySelector('.btn-book');
            
            const blockedInRange = getBlockedDatesInRange(state.checkin, state.checkout);
            
            if (blockedInRange.length > 0) {
                notice.style.display = 'flex';
                notice.className = 'availability-notice error';
                message.textContent = `Sorry, ${blockedInRange.length} date(s) in your selection are unavailable. Please choose different dates.`;
                bookBtn.disabled = true;
                bookBtn.style.opacity = '0.5';
                bookBtn.style.cursor = 'not-allowed';
            } else {
                notice.style.display = 'flex';
                notice.className = 'availability-notice success';
                message.textContent = 'Great news! Your selected dates are available.';
                bookBtn.disabled = false;
                bookBtn.style.opacity = '1';
                bookBtn.style.cursor = 'pointer';
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    notice.style.display = 'none';
                }, 3000);
            }
        }

        function calculatePricing() {
            const nights = getNights();
            const subtotal = nights * NIGHTLY_RATE;
            
            // Weekly discount (10% if 7+ nights)
            let discount = 0;
            let discountLabel = '';
            if (nights >= 7) {
                discount = Math.round(subtotal * 0.10);
                discountLabel = 'Weekly discount (10%)';
            }
            
            const total = subtotal + CLEANING_FEE + SERVICE_FEE - discount;
            
            return { nights, subtotal, discount, discountLabel, total };
        }

        function updateAllDisplays() {
            const nights = getNights();
            const pricing = calculatePricing();
            const totalGuests = state.adults + state.children;

            // Update trip details section
            document.getElementById('checkin-display').textContent = formatDateShort(state.checkin);
            document.getElementById('checkout-display').textContent = formatDateShort(state.checkout);
            document.getElementById('guests-nights').textContent = `${totalGuests} Guest${totalGuests !== 1 ? 's' : ''} • ${nights} Night${nights !== 1 ? 's' : ''}`;

            // Update summary sidebar
            document.getElementById('summary-checkin').textContent = formatDateLong(state.checkin);
            document.getElementById('summary-checkout').textContent = formatDateLong(state.checkout);
            
            let guestText = `${state.adults} Adult${state.adults !== 1 ? 's' : ''}`;
            if (state.children > 0) {
                guestText += `, ${state.children} Child${state.children !== 1 ? 'ren' : ''}`;
            }
            document.getElementById('summary-guests').textContent = guestText;

            // Update pricing
            document.getElementById('price-nights').textContent = `$${NIGHTLY_RATE} × ${nights} night${nights !== 1 ? 's' : ''}`;
            document.getElementById('price-subtotal').textContent = `$${pricing.subtotal.toLocaleString()}`;
            
            // Show/hide discount row
            const discountRow = document.getElementById('discount-row');
            if (pricing.discount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('discount-label').textContent = pricing.discountLabel;
                document.getElementById('discount-amount').textContent = `-$${pricing.discount.toLocaleString()}`;
            } else {
                discountRow.style.display = 'none';
            }
            
            document.getElementById('price-total').textContent = `$${pricing.total.toLocaleString()}`;
            document.getElementById('btn-total').textContent = `Book now`;
            
            // Update mobile price banner
            const mobileTotal = document.getElementById('mobile-total');
            const mobileNights = document.getElementById('mobile-nights');
            const mobileFooterTotal = document.getElementById('mobile-footer-total');
            if (mobileTotal) mobileTotal.textContent = `$${pricing.total.toLocaleString()}`;
            if (mobileNights) mobileNights.textContent = `${nights} night${nights !== 1 ? 's' : ''}`;
            if (mobileFooterTotal) mobileFooterTotal.textContent = `$${pricing.total.toLocaleString()}`;

            // Update cancellation policy dates (7 days before checkin)
            const cancelDate = new Date(state.checkin);
            cancelDate.setDate(cancelDate.getDate() - 7);
            const cancelDateStr = formatDatePolicy(cancelDate);
            document.getElementById('cancel-date-50').textContent = cancelDateStr;
            document.getElementById('cancel-date-100').textContent = cancelDateStr;
            
            // Update mobile cancel date
            const mobileCancelDate = document.getElementById('mobile-cancel-date');
            if (mobileCancelDate) mobileCancelDate.textContent = cancelDateStr;

            // Update checkout minimum date
            const minCheckout = new Date(state.checkin);
            minCheckout.setDate(minCheckout.getDate() + 1);
            document.getElementById('checkout-date').min = formatDateForInput(minCheckout);
        }

        // Guest picker functions
        function openGuestPicker() {
            document.getElementById('guest-picker').style.display = 'block';
        }

        function closeGuestPicker() {
            document.getElementById('guest-picker').style.display = 'none';
            updateAllDisplays();
        }

        function adjustGuests(type, delta) {
            if (type === 'adults') {
                state.adults = Math.max(1, Math.min(10, state.adults + delta));
                document.getElementById('adult-count').textContent = state.adults;
            } else {
                state.children = Math.max(0, Math.min(6, state.children + delta));
                document.getElementById('child-count').textContent = state.children;
            }
        }

        // Payment selection
        function selectPayment(el) {
            document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
        }

        // Policy accordion
        function togglePolicy(header) {
            const section = header.parentElement;
            const content = section.querySelector('.policy-content');
            const isOpen = header.classList.contains('open');
            
            document.querySelectorAll('.policy-header').forEach(h => {
                h.classList.remove('open');
                const c = h.parentElement.querySelector('.policy-content');
                if (c) c.style.display = 'none';
            });
            
            if (!isOpen) {
                header.classList.add('open');
                content.style.display = 'block';
            }
        }

        // Mobile policy accordion
        function toggleMobilePolicy(header) {
            const content = header.nextElementSibling;
            const isOpen = header.classList.contains('open');
            
            // Close all others
            document.querySelectorAll('.mobile-policy-header').forEach(h => {
                h.classList.remove('open');
                h.nextElementSibling.classList.remove('open');
            });
            
            // Toggle this one
            if (!isOpen) {
                header.classList.add('open');
                content.classList.add('open');
            }
        }

        // Form submission
        function confirmBooking() {
            // Check availability first
            const blockedInRange = getBlockedDatesInRange(state.checkin, state.checkout);
            if (blockedInRange.length > 0) {
                alert('Sorry, the selected dates are not available. Please choose different dates.');
                return;
            }

            const required = document.querySelectorAll('input[required]');
            let valid = true;
            required.forEach(input => {
                if (!input.value.trim()) {
                    input.style.borderColor = '#c94444';
                    valid = false;
                } else {
                    input.style.borderColor = '#ebe7dc';
                }
            });

            if (valid) {
                const pricing = calculatePricing();
                alert(`Thank you for your booking!\n\nCheck-in: ${formatDateLong(state.checkin)}\nCheck-out: ${formatDateLong(state.checkout)}\nTotal: $${pricing.total.toLocaleString()}\n\nA confirmation email will be sent shortly. We look forward to welcoming you to Dublin Tree Haven.`);
            } else {
                alert('Please fill in all required fields.');
            }
        }

        // Format card number
        document.querySelector('input[placeholder="1234 5678 9012 3456"]')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
            let formatted = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formatted;
        });

        // Format expiry
        document.querySelector('input[placeholder="MM / YY"]')?.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0,2) + ' / ' + value.substring(2,4);
            }
            e.target.value = value;
        });

        // Close guest picker when clicking outside
        document.addEventListener('click', function(e) {
            const picker = document.getElementById('guest-picker');
            const editLink = document.querySelector('.edit-link');
            if (picker.style.display === 'block' && 
                !picker.contains(e.target) && 
                e.target !== editLink) {
                closeGuestPicker();
            }
        });
    </script>
</body>
</html>
